from scrapy.spider import Spider
from scrapy.http import FormRequest, Request
#import urllib2
#urllib2.install_opener(urllib2.build_opener(urllib2.HTTPCookieProcessor()))

class BookstoreSpider(Spider):
    name = "mail_spider"
    allowed_domains = []
    start_urls = ('https://wmail1.cc.ntu.edu.tw/imp/redirect.php',)


    def parse(self, response):
        for i, url in enumerate(self.start_urls):
            yield FormRequest(url, meta = {'cookiejar': i},
                                #formdata = self.formdata,
                                #headers = self.headers,
                                callback = self.login)#jump to login page


    def login(self):
        return [FormRequest.from_response(response,
                    formdata={	
				'load_frameset':1,
				'autologin:0,
				'anchor_string':'',
				'server_key':'ccms',
				'imapuser':'b96303123',
				'pass':'x251227',
				'new_lang':'zh_TW',
			      },
		    meta = {'cookiejar':response.meta['cookiejar']},
                    callback=self.after_login)]


    def after_login(self, response):
        # check login succeed before going on
 	print(response.body)


